# Example docker-compose.yml for running roji
#
# Copy this file to your desired location and customize as needed.
#
# Usage:
#   1. Create the shared network:
#      docker network create roji
#
#   2. Generate certificates with mkcert:
#      mkcert -install
#      mkdir -p certs
#      mkcert -cert-file certs/cert.pem -key-file certs/key.pem "*.localhost" localhost 127.0.0.1
#
#   3. Start roji:
#      docker compose up -d
#

services:
  roji:
    # Use pre-built image (recommended):
    image: ghcr.io/kan/roji:latest
    # Or build from source:
    # build:
    #   context: .
    #   target: production
    container_name: roji
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      # Docker socket for container discovery (read-only)
      - /var/run/docker.sock:/var/run/docker.sock:ro
      # TLS certificates
      - ./certs:/certs
    environment:
      - ROJI_NETWORK=roji
      - ROJI_DOMAIN=localhost          # Change to kan.localhost if desired
      - ROJI_CERTS_DIR=/certs
      - ROJI_DASHBOARD=roji.localhost  # Dashboard URL
      - ROJI_LOG_LEVEL=info
    labels:
      # Mark this as roji itself (to avoid self-routing)
      - "roji.self=true"
    networks:
      - roji

networks:
  roji:
    external: true
